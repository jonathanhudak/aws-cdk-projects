const synthetics = require("Synthetics");
const log = require("SyntheticsLogger");

const pageLoadBlueprint = async function () {
  // Configure the stage of the API using environment variables
  const url = String(`${process.env.URL}?token=${process.env.TOKEN}`);

  const page = await synthetics.getPage();
  const response = await page.goto(url, {
    waitUntil: "domcontentloaded",
    timeout: 30000,
  });
  // Wait for page to render. Increase or decrease wait time based on endpoint being monitored.
  await page.waitFor(60000);
  // This will take a screenshot that will be included in test output artifacts.
  await synthetics.takeScreenshot("loaded", "loaded");
  const pageTitle = await page.title();
  const pageUrl = await page.url();
  log.info("Page title: " + pageTitle);
  log.info("Page url: " + pageUrl);
  if (response.status() !== 200) {
    throw "Failed to load page!";
  }
};

exports.handler = async () => {
  return await pageLoadBlueprint();
};
